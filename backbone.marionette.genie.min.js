// GenieJS (Backbone.Marionette.Genie)
// -----------------------------------
// v0.3.6
// 
// Copyright (c) 2013 Michael Spencer; Trynd, LLC
// Distributed under the MIT license
//
// http://github.com/trynd/geniejs

(function(t,i,n){"use strict";var o,e,s,r,p,l,a,h,u,c,d,g,f,m;return m=this,g=m.Genie,f=i.Genie,s=function(t){return this.options=n.extend({},t),this.parseOptions(this.options,this.validOptions),this.processOptions(this.options),this.define=this.createDefine(this.options),n.isFunction(this.initialize)&&this.initialize(t),this},s.prototype.validOptions=["startWithParent","initializer","vent","duct","region","regions","controller","router","passStartOptionsToVent","passStartOptionsToDuct","passStartOptionsToRegion","passStartOptionsToController","passStartOptionsToRouter","ventOptions","ductOptions","regionOptions","controllerOptions","routerOptions"],s.prototype.parseOptions=d=function(t,i){if(n.isObject(t)){var o,e,s;for(o=0,e=i.length;e>o;o++)s=i[o],s in t||s in this&&(t[s]=this[s])}else t={};return t},s.prototype.processOptions=function(t){return this.startWithParent="startWithParent"in t?t.startWithParent:!0,t},s.prototype.mergeHelperClassOptions=function(t,i,o,e){var s={};return o===!0&&n.extend(s,e),n.extend(s,t),n.isObject(i)&&n.extend(s,i),s},s.prototype.createDefine=function(){var t=this;return function(){return this.genie=t,this.mod=this,n.extend(this,c),this.listenLocal=h,this.listenRemote=u,this.addInitializer(function(i){var n;return n=t.options,this.startOptions=i,"vent"in n&&this.addVent(n.vent),"duct"in n&&this.addDuct(n.duct),"region"in n&&this.addRegion("region",n.region),"regions"in n&&this.addRegions(n.regions),"controller"in n&&this.addController(n.controller),"router"in n&&this.addRouter(n.router),"initializer"in n&&n.initializer.apply(this,arguments),this})}},c={addController:function(t,i){if(null!=t&&t!==!1){var e;return t===!0&&(t=o),n.isFunction(t)?(i=this.genie.mergeHelperClassOptions({app:this.app,mod:this},n.isObject(i)?i:this.genie.options.controllerOptions,this.genie.options.passStartOptionsToController,this.startOptions),e=new t(i)):e=t,this.controller=e}},addDuct:function(t,i){if(null!=t&&t!==!1){var o;return t===!0&&(t=e),n.isFunction(t)?(i=this.genie.mergeHelperClassOptions({app:this.app,mod:this},n.isObject(i)?i:this.genie.options.ductOptions,this.genie.options.passStartOptionsToDuct,this.startOptions),o=new t(i)):o=t,this.duct=o}},addRegion:function(t,i,o){if(n.isString(t)||(o=i,i=t,t="region"),null!=t&&null!=i){var e,s,p;if(n.isArray(i)&&(n.isObject(o)||(o=i[1]),i=i[0]),i!==!1)return s=n.isString(i),e=!s&&n.isFunction(i),"regions"in this||(this.regions={}),s||e?(o=this.genie.mergeHelperClassOptions({app:this.app,mod:this},n.isObject(o)?o:this.genie.options.regionOptions,this.genie.options.passStartOptionsToRegion,this.startOptions),s?(o.el=i,p=new r(o)):p=new i(o)):p=i,this.regions[t]=p,"region"===t&&(this.region=p),p}},addRegions:function(t){n.isObject(t)&&n.each(t,function(t,i){this.addRegion(i,t)},this)},addRouter:function(t,i){if(null!=t&&t!==!1){var o;return t===!0&&(t=p),n.isFunction(t)?(i=this.genie.mergeHelperClassOptions({app:this.app,mod:this},n.isObject(i)?i:this.genie.options.routerOptions,this.genie.options.passStartOptionsToRouter,this.startOptions),!n.isObject(this.controller)||"controller"in i||(i.controller=this.controller),o=new t(i)):o=t,this.router=o}},addVent:function(t,i){if(null!=t&&t!==!1){var o;return t===!0&&(t=l),n.isFunction(t)?(i=this.genie.mergeHelperClassOptions({app:this.app,mod:this},n.isObject(i)?i:this.genie.options.ventOptions,this.genie.options.passStartOptionsToVent,this.startOptions),o=new t(i)):o=t,this.vent=o}}},s.prototype.addInitializer=function(t){if(n.isFunction(t))if("initializer"in this.options){var i=this.options.initializer;this.options.initializer=function(){i.apply(this,arguments),t.apply(this,arguments)}}else this.options.initializer=t},s.prototype.addController=function(t,i){null!=t&&(this.options.controller=t,n.isObject(i)&&(this.options.controllerOptions=n.extend({},i)))},s.prototype.addDuct=function(t,i){null!=t&&(this.options.duct=t,n.isObject(i)&&(this.options.ductOptions=n.extend({},i)))},s.prototype.addRegion=function(t,i,o){n.isString(t)||(o=i,i=t,t="region");var e=i;n.isObject(o)&&(e=n.isArray(e)?[e[0],n.extend({},o)]:[e,n.extend({},o)]),"region"===t?this.options.region=e:("regions"in this.options||(this.options.regions={}),this.options.regions[t]=e)},s.prototype.addRegions=function(t){n.isObject(t)&&n.each(t,function(t,i){this.addRegion(i,t)},this)},s.prototype.addRouter=function(t,i){null!=t&&(this.options.router=t,n.isObject(i)&&(this.options.routerOptions=n.extend({},i)))},s.prototype.addVent=function(t,i){null!=t&&(this.options.vent=t,n.isObject(i)&&(this.options.ventOptions=n.extend({},i)))},s.extend=t.Model.extend,s.noConflict=function(){return m.Genie=g,this},s.noConflictMarionette=function(){return i.Genie=f,this},a=function(t){return n.isObject(t)&&(this.options=n.extend({},t),"app"in t&&(this.app=t.app),"mod"in t&&(this.mod=t.mod)),this},s.Vent=l=function(t){return a.apply(this,arguments),n.isFunction(this.initialize)&&this.initialize(t),this},l.extend=s.extend,n.extend(l.prototype,t.Events),s.Duct=e=function(t){return a.apply(this,arguments),this.options=this.parseOptions(this.options,this.validOptions),"local"in this.options||n.isObject(this.mod)&&(this.options.local=this.mod.vent),"remote"in this.options||n.isObject(this.app)&&(this.options.remote=this.app.vent),this.local=this.options.local,this.remote=this.options.remote,n.isFunction(this.initialize)&&this.initialize(t),this},e.prototype.validOptions=["local","remote"],e.prototype.parseOptions=d,e.prototype.map=function(t,i,o,e,s,r){return null!=o?(null==e&&(e=o),this.listenTo(t,o,function(){var t;if(t=arguments,n.isFunction(s)&&(null==r&&(r=this),t=s.apply(r,t)),t===!0)t=arguments;else if(t===!1)return;return n.isArguments(t)||n.isArray(t)?i.trigger.apply(i,[e].concat(Array.prototype.slice.call(t))):void 0})):void 0},e.prototype.in=function(t,i,n,o){return this.map(this.remote,this.local,t,i,n,o)},e.prototype.out=function(t,i,n,o){return this.map(this.local,this.remote,t,i,n,o)},e.prototype.fromApp=function(t,i,n,o){return this.map(this.app,this.local,t,i,n,o)},e.prototype.fromMod=function(t,i,n,o){return this.map(this.mod,this.local,t,i,n,o)},e.prototype.fromLocal=function(t,i,n,o){return this.map(this.local,this.local,t,i,n,o)},e.prototype.listenLocal=function(t,i,n){if(this.local)return this.listenTo(this.local,t,i,n);throw"local vent not defined"},e.prototype.listenRemote=function(t,i,n){if(this.remote)return this.listenTo(this.remote,t,i,n);throw"remote vent not defined"},e.extend=s.extend,n.extend(e.prototype,t.Events),s.Region=r=i.Region.extend({constructor:function(){return a.apply(this,arguments),i.Region.apply(this,arguments),this}}),s.Controller=o=i.Controller.extend({constructor:function(){return a.apply(this,arguments),i.Controller.apply(this,arguments),this}}),s.Router=p=i.AppRouter.extend({constructor:function(){return a.apply(this,arguments),i.AppRouter.apply(this,arguments),this}}),h=function(t,i,n){var o;if(null!=this.mod&&(null!=this.mod.duct?null!=this.mod.duct.local&&(o=this.mod.duct.local):null!=this.mod.vent&&(o=this.mod.vent)),o)return this.listenTo(o,t,i,n);throw"local vent not defined"},u=function(t,i,n){var o;if(null!=this.mod&&null!=this.mod.duct?null!=this.mod.duct.remote&&(o=this.mod.duct.remote):null!=this.app&&null!=this.app.vent&&(o=this.mod.vent),o)return this.listenTo(o,t,i,n);throw"remote vent not defined"},n.each([l,r,o,p],function(t){t.prototype.listenLocal=h,t.prototype.listenRemote=u}),m.Genie=i.Genie=s}).call(this,Backbone,Backbone.Marionette,_);
